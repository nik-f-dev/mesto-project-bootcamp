(()=>{"use strict";var e;function t(t){e=t,t.classList.add("popup_opened"),document.addEventListener("keydown",n)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(t){"Escape"===t.key&&(o(e),console.log(e))}function r(e,t){e.textContent=t}var c=document.querySelector(".photo-grid"),a=document.querySelector(".popup__photo"),u=document.querySelector(".popup__img-title"),i=document.querySelector(".img-popup"),d=document.querySelector("#template").content,p=document.querySelector("#delete-popup__save-button"),s=document.querySelector(".delete-popup");function l(e){var n,l,f=function(e){var o,n=d.querySelector(":first-child").cloneNode(!0);return n.querySelector(".photo-grid__image").src=e.link,n.querySelector(".photo-grid__image").alt=e.name,n.querySelector(".photo-grid__title").textContent=e.name,e.likes.length>0&&(n.querySelector(".photo-grid__likes").textContent=e.likes.length),n.dataset.id=e._id,"9cfb4c2414d52e5ba6a8acdd"===e.owner._id&&n.querySelector(".photo-grid__button-delete").classList.add("photo-grid__button-delete_active"),e.likes.some((function(e){return"9cfb4c2414d52e5ba6a8acdd"===e._id}))&&n.querySelector(".photo-grid__like").classList.add("photo-grid__like_active"),(o=n.querySelector(".photo-grid__image")).addEventListener("click",(function(){a.src=o.src,a.alt=o.alt,u.textContent=a.alt,t(i)})),n}(e);c.prepend(f),(l=(n=f).querySelector(".photo-grid__like")).addEventListener("click",(function(){var e;l.classList.contains("photo-grid__like_active")?(e=n.dataset.id,fetch("https://nomoreparties.co/v1/wbf-cohort-8/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){l.classList.remove("photo-grid__like_active"),_()})):function(e){return fetch("https://nomoreparties.co/v1/wbf-cohort-8/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n.dataset.id).then((function(){l.classList.add("photo-grid__like_active"),_()}))})),function(e){var n=e.querySelector(".photo-grid__button-delete"),c=e;n.addEventListener("click",(function(){r(p,"Да"),t(s),function(e){p.addEventListener("click",(function(t){var n;t.preventDefault(),(n=e.dataset.id,fetch("https://nomoreparties.co/v1/wbf-cohort-8/cards/".concat(n),{method:"DELETE",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d"}})).then((function(e){return e.ok?(_(),r(p,"Удаление.."),void o(s)):Promise.reject("".concat(e.status))})).catch((function(e){return console.log(e)}))}))}(c)}))}(f)}function _(){m("cards").then((function(e){c.replaceChildren(""),e.reverse().forEach(l)})).catch((function(e){return console.log(e)}))}var f=document.querySelector(".profile__image");function m(e,t){return fetch("https://nomoreparties.co/v1/wbf-cohort-8/".concat(e),{method:t,headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}document.querySelector(".popup__photo");var v=document.querySelector(".profile__title"),h=document.querySelector(".profile__image"),y=document.querySelector(".profile__subtitle"),S=document.querySelector(".edit-popup"),b=document.querySelector(".edit-popup__edit-form"),q=document.querySelector("#edit-popup__name"),g=document.querySelector("#edit-popup__description"),k=document.querySelector(".popup__button-save_type_edit"),L=document.querySelector(".add-popup"),E=document.querySelector("#add-popup__name"),C=document.querySelector("#add-popup__link"),j=document.querySelector(".popup__button-save_type_add"),x=document.querySelectorAll(".popup__button-close"),P=document.querySelector(".avatar-popup"),T=document.querySelector(".avatar-popup__item"),w=document.querySelector(".popup__button-save_type_avatar");function A(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button-save_disable"):t.classList.add("popup__button-save_disable")}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&o(e)}))})),x.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))}));var z=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),N=document.querySelector("#edit-popup__name"),O=document.querySelector("#edit-popup__description"),J=document.querySelector(".add-popup__add-form"),H=document.querySelector(".avatar-popup__avatar-form"),G=document.querySelector(".profile__edit-avatar-button");z.addEventListener("click",(function(){N.value=v.textContent,O.value=y.textContent,r(k,"Сохранить"),t(S)})),D.addEventListener("click",(function(){r(j,"Создать"),t(L)})),b.addEventListener("submit",(function(e){var t,n;e.preventDefault(),r(k,"Сохранение..."),(t=q.value,n=g.value,fetch("https://nomoreparties.co/v1/wbf-cohort-8/users/me",{method:"PATCH",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v.textContent=e.name,y.textContent=e.about})),o(S)})),J.addEventListener("submit",(function(e){var t,n;e.preventDefault(),r(j,"Создание..."),o(L),t=E.value,n=C.value,fetch("https://nomoreparties.co/v1/wbf-cohort-8/cards",{method:"POST",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){l(e)})),e.target.reset()})),G.addEventListener("click",(function(){r(w,"Сохранить"),t(P)})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),r(w,"Сохранение..."),(t=T.value,fetch("https://nomoreparties.co/v1/wbf-cohort-8/users/me/avatar",{method:"PATCH",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){h.src=t.avatar,o(P),e.target.reset()}))})),m("users/me","GET").then((function(e){v.textContent=e.name,y.textContent=e.about,f.src=e.avatar})).catch((function(e){return console.log(e)})),_(),Array.from(document.querySelectorAll(".popup__container_type-form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__item")),o=e.querySelector(".popup__button-save");A(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__item_type_error"),o.classList.remove("popup__item-error_active"),o.textContent=""}(e,t):function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__item_type_error"),o.textContent=t.validationMessage,o.classList.add("popup__item-error_active")}(e,t)}(e,n),A(t,o)}))}))}(e)}))})();