(()=>{"use strict";var e,t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function o(t){var o=document.querySelector(".".concat(t.id,"__button-save"));"img-popup"!==t.id&&(o.classList.add("popup__button-save_disable"),a(o)),e=t,t.classList.add("popup_opened"),document.addEventListener("keydown",r)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&(n(e),console.log(e))}function c(e,t){e.textContent=t}function a(e){e.setAttribute("disabled","")}function u(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}t.d({},{x:()=>v});var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-8/",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"}};function l(e,t){return fetch("".concat(i.baseUrl).concat(e),t).then(u)}var d=document.querySelector(".photo-grid"),s=document.querySelector(".popup__photo"),p=document.querySelector(".popup__img-title"),f=document.querySelector(".img-popup"),_=document.querySelector("#template").content;function m(e){l("cards",i).then((function(t){d.replaceChildren(""),t.reverse().forEach((function(t){!function(e,t){var n,r=_.querySelector(":first-child").cloneNode(!0),c=r.querySelector(".photo-grid__image");c.src=e.link,c.alt=e.name,r.querySelector(".photo-grid__title").textContent=e.name,e.likes.length>0&&(r.querySelector(".photo-grid__likes").textContent=e.likes.length),r.dataset.id=e._id,e.owner._id===t&&r.querySelector(".photo-grid__button-delete").classList.add("photo-grid__button-delete_active"),e.likes.some((function(e){return e._id===t}))&&r.querySelector(".photo-grid__like").classList.add("photo-grid__like_active"),(n=c).addEventListener("click",(function(){s.src=n.src,s.alt=n.alt,p.textContent=s.alt,o(f)})),function(e){var t=e.querySelector(".photo-grid__like"),o=t.querySelector(".photo-grid__likes");t.addEventListener("click",(function(){var n;t.classList.contains("photo-grid__like_active")?(n=e.dataset.id,fetch("".concat(i.baseUrl,"cards/likes/").concat(n),{method:"DELETE",headers:i.headers}).then(u)).then((function(){t.classList.remove("photo-grid__like_active"),o.textContent=parseInt(o.textContent)-1})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(i.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(u)}(e.dataset.id).then((function(){t.classList.add("photo-grid__like_active"),""===o.textContent&&(o.textContent="0"),o.textContent=parseInt(o.textContent)+1})).catch((function(e){return console.log(e)}))}))}(r),function(e){var t=e.querySelector(".photo-grid__button-delete");t.addEventListener("click",(function(){var o;(o=e.dataset.id,fetch("".concat(i.baseUrl,"cards/").concat(o),{method:"DELETE",headers:i.headers}).then(u)).then((function(){return t.parentElement.remove()})).catch((function(e){return console.log(e)}))}))}(r),d.prepend(r)}(t,e)}))})).catch((function(e){return console.log(e)}))}document.querySelector(".popup__photo");var v,h=document.querySelector(".profile__title"),y=document.querySelector(".profile__image"),S=document.querySelector(".profile__subtitle"),b=document.querySelector(".edit-popup"),g=document.querySelector(".edit-popup__edit-form"),q=document.querySelector("#edit-popup__name"),C=document.querySelector("#edit-popup__description"),E=document.querySelector(".popup__button-save_type_edit"),L=document.querySelector(".add-popup"),k=document.querySelector("#add-popup__name"),x=document.querySelector("#add-popup__link"),A=document.querySelector(".popup__button-save_type_add"),O=document.querySelectorAll(".popup__button-close"),j=document.querySelector(".avatar-popup"),U=document.querySelector(".avatar-popup__item"),w=document.querySelector(".popup__button-save_type_avatar");function P(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o),t.removeAttribute("disabled")):t.classList.add(o)}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&n(e)}))})),O.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return n(t)}))}));var D,I,B,N,J,H,M,z=document.querySelector(".profile__edit-button"),$=document.querySelector(".profile__add-button"),F=document.querySelector("#edit-popup__name"),G=document.querySelector("#edit-popup__description"),K=document.querySelector(".add-popup__add-form"),Q=document.querySelector(".avatar-popup__avatar-form"),R=document.querySelector(".profile__edit-avatar-button");z.addEventListener("click",(function(){F.value=h.textContent,G.value=S.textContent,o(b)})),$.addEventListener("click",(function(){o(L)})),g.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(E,"Сохранение..."),(t=q.value,o=C.value,fetch("".concat(i.baseUrl,"users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:o})}).then(u)).then((function(e){h.textContent=e.name,S.textContent=e.about,n(b)})).catch((function(e){return console.log(e)})).finally((function(){return c(E,"Сохранить")}))})),K.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(A,"Создание..."),a(A),(t=k.value,o=x.value,fetch("".concat(i.baseUrl,"cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:o})}).then(u)).then((function(t){m(v),n(L),e.target.reset(),createCard(t,v)})).catch((function(e){return console.log(e)})).finally((function(){return c(A,"Создать")}))})),R.addEventListener("click",(function(){o(j)})),Q.addEventListener("submit",(function(e){var t;e.preventDefault(),c(w,"Сохранение..."),(t=U.value,fetch("".concat(i.baseUrl,"users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(u)).then((function(t){y.src=t.avatar,n(j),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){return c(w,"Сохранить")}))})),Promise.all([l("users/me",i).then((function(e){return v=e._id})),l("cards",i)]).then((function(e){var t,o,n=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c,a,u=[],i=!0,l=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(t,o)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?T(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],c=n[1];console.log(r),console.log(c),m(r),l("users/me",i).then((function(e){h.textContent=e.name,S.textContent=e.about,y.src=e.avatar})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),I=(D={formSelector:".popup__container_type-form",inputSelector:".popup__item",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disable",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,B=D.inputSelector,N=D.submitButtonSelector,J=D.inactiveButtonClass,H=D.inputErrorClass,M=D.errorClass,Array.from(document.querySelectorAll(I)).forEach((function(e){!function(e,t,o,n,r,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(o);P(a,u),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,o,n){t.validity.valid?function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),r.classList.remove(n),r.textContent=""}(e,t,o,n):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.textContent=t.validationMessage,r.classList.add(n)}(e,t,o,n)}(e,t,r,c),P(a,u,n)}))}))}(e,B,N,J,H,M)}))})();