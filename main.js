(()=>{"use strict";var e,t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function o(t){e=t,t.classList.add("popup_opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(t){"Escape"===t.key&&(r(e),console.log(e))}function c(e,t){e.textContent=t}function a(e){e.setAttribute("disabled",""),e.classList.add("popup__button-save_disable")}function u(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}t.d({},{x:()=>v});var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-8/",headers:{authorization:"89323da2-785e-48f5-ab5a-36b87f5e2d1d","Content-Type":"application/json"}};function l(e,t){return fetch("".concat(i.baseUrl).concat(e),t).then(u)}var d=document.querySelector(".photo-grid"),s=document.querySelector(".popup__photo"),p=document.querySelector(".popup__img-title"),f=document.querySelector(".img-popup"),_=document.querySelector("#template").content;function m(e){var t,r=_.querySelector(":first-child").cloneNode(!0),n=r.querySelector(".photo-grid__image");return n.src=e.link,n.alt=e.name,r.querySelector(".photo-grid__title").textContent=e.name,e.likes.length>0&&(r.querySelector(".photo-grid__likes").textContent=e.likes.length),r.dataset.id=e._id,e.owner._id===v&&r.querySelector(".photo-grid__button-delete").classList.add("photo-grid__button-delete_active"),e.likes.some((function(e){return e._id===v}))&&r.querySelector(".photo-grid__like").classList.add("photo-grid__like_active"),(t=n).addEventListener("click",(function(){s.src=t.src,s.alt=t.alt,p.textContent=s.alt,o(f)})),function(e){var t=e.querySelector(".photo-grid__like"),o=t.querySelector(".photo-grid__likes");t.addEventListener("click",(function(){var r;t.classList.contains("photo-grid__like_active")?(r=e.dataset.id,fetch("".concat(i.baseUrl,"cards/likes/").concat(r),{method:"DELETE",headers:i.headers}).then(u)).then((function(e){t.classList.remove("photo-grid__like_active"),o.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(i.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(u)}(e.dataset.id).then((function(e){t.classList.add("photo-grid__like_active"),o.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}))}(r),function(e){var t=e.querySelector(".photo-grid__button-delete");t.addEventListener("click",(function(){var o;(o=e.dataset.id,fetch("".concat(i.baseUrl,"cards/").concat(o),{method:"DELETE",headers:i.headers}).then(u)).then((function(){return t.closest(".photo-grid__item").remove()})).catch((function(e){return console.log(e)}))}))}(r),r}document.querySelector(".popup__photo");var v,h=document.querySelector(".profile__title"),y=document.querySelector(".profile__image"),S=document.querySelector(".profile__subtitle"),b=document.querySelector(".edit-popup"),g=document.querySelector(".edit-popup__edit-form"),q=document.querySelector("#edit-popup__name"),k=document.querySelector("#edit-popup__description"),L=document.querySelector(".popup__button-save_type_edit"),E=document.querySelector(".add-popup"),C=document.querySelector("#add-popup__name"),A=document.querySelector("#add-popup__link"),x=document.querySelector(".popup__button-save_type_add"),O=document.querySelectorAll(".popup__button-close"),j=document.querySelector(".avatar-popup"),U=document.querySelector(".avatar-popup__item"),w=document.querySelector(".popup__button-save_type_avatar");function P(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o),t.removeAttribute("disabled")):(t.classList.add(o),t.setAttribute("disabled",""))}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&r(e)}))})),O.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return r(t)}))}));var D,B,N,I,J,H,M,z=document.querySelector(".profile__edit-button"),$=document.querySelector(".profile__add-button"),F=document.querySelector("#edit-popup__name"),G=document.querySelector("#edit-popup__description"),K=document.querySelector(".add-popup__add-form"),Q=document.querySelector(".avatar-popup__avatar-form"),R=document.querySelector(".profile__edit-avatar-button");z.addEventListener("click",(function(){F.value=h.textContent,G.value=S.textContent,o(b)})),$.addEventListener("click",(function(){o(E)})),g.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(L,"Сохранение..."),(t=q.value,o=k.value,fetch("".concat(i.baseUrl,"users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:o})}).then(u)).then((function(e){h.textContent=e.name,S.textContent=e.about,r(b),a(L)})).catch((function(e){return console.log(e)})).finally((function(){return c(L,"Сохранить")}))})),K.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(x,"Создание..."),(t=C.value,o=A.value,fetch("".concat(i.baseUrl,"cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:o})}).then(u)).then((function(t){var o;r(E),e.target.reset(),a(x),o=m(t),d.prepend(o)})).catch((function(e){return console.log(e)})).finally((function(){return c(x,"Создать")}))})),R.addEventListener("click",(function(){o(j)})),Q.addEventListener("submit",(function(e){var t;e.preventDefault(),c(w,"Сохранение..."),(t=U.value,fetch("".concat(i.baseUrl,"users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(u)).then((function(t){y.src=t.avatar,r(j),a(w),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){return c(w,"Сохранить")}))})),Promise.all([l("users/me",i),l("cards",i)]).then((function(e){var t,o,r=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,c,a,u=[],i=!0,l=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;i=!1}else for(;!(i=(r=c.call(o)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,n=e}finally{try{if(!i&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw n}}return u}}(t,o)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?T(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],c=r[1];v=n._id,c.forEach((function(e){d.append(m(e))})),h.textContent=n.name,S.textContent=n.about,y.src=n.avatar})).catch((function(e){return console.log(e)})),B=(D={formSelector:".popup__container_type-form",inputSelector:".popup__item",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disable",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,N=D.inputSelector,I=D.submitButtonSelector,J=D.inactiveButtonClass,H=D.inputErrorClass,M=D.errorClass,Array.from(document.querySelectorAll(B)).forEach((function(e){!function(e,t,o,r,n,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(o);P(a,u,r),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,o,r){t.validity.valid?function(e,t,o,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),n.classList.remove(r),n.textContent=""}(e,t,o,r):function(e,t,o,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),n.textContent=t.validationMessage,n.classList.add(r)}(e,t,o,r)}(e,t,n,c),P(a,u,r)}))}))}(e,N,I,J,H,M)}))})();